/**
 * @preserve FamilySearch JavaScript SDK
 * (c) 2013 Dallan Quass and other contributors
 * Released under the MIT license
 * http://github.com/rootsdev/familysearch-javascript-sdk
 */

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FamilySearch=t()}(this,function(){function e(e,t,r){n[e]={deps:3===arguments.length?t:[],fn:3===arguments.length?r:t}}function t(e){var o=n[e],s=[],i=o.fn;if("function"==typeof i){for(var c=0,u=o.deps.length;u>c;c++){var a=o.deps[c],p=r[a];void 0===p&&(p=t(a),r[a]=p),s.push(p)}i=o.fn.apply(this,s)}return i}var n={},r={};return e("globals",{appKey:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,authCallbackUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:354e4,maxAccessTokenCreationTime:8634e4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://sandbox.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}),e("helpers",["globals"],function(e){function t(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]!==e[n])return!1;return!0}function n(e,t){return c.isAbsoluteUrl(t)?t:e+("/"!==t.charAt(0)?"/":"")+t}function r(t,n,r){return r&&e.clearTimeout(r),e.setTimeout(function(){t()},n)}function o(e){a=r(c.eraseAccessToken,e,a)}function s(e){p=r(c.eraseAccessToken,e,p)}function i(){e.clearTimeout(a),a=null,e.clearTimeout(p),p=null}var c={};Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"".__proto__?function(e){return e.__proto__}:function(e){return e.constructor.prototype}),c.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.prototype.toString.call(e)},c.isNumber=function(e){return"[object Number]"==Object.prototype.toString.call(e)},c.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},c.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)},c.isFunction=function(e){return"function"!=typeof/./?"function"==typeof e:"[object Function]"==Object.prototype.toString.call(e)},c.isObject=function(e){return e===Object(e)},c.isUndefined=function(e){return void 0===e};var u=c.forEach=function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(n,e[r],r,e)==={})return}else for(var s in e)if(e.hasOwnProperty(s)&&t.call(n,e[s],s,e)==={})return};c.keys=Object.keys||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},c.filter=function(e,n,r){var o=[],s=c.isFunction(n);return u(e,function(e){(s?n.call(r,e):t(n,e))&&o.push(e)}),o},c.map=function(e,t,n){var r=[];return u(e,function(e,o,s){r.push(t.call(n,e,o,s))}),r},c.contains=function(e,t){if(null==e)return!1;if(e.indexOf&&e.indexOf===Array.prototype.indexOf)return-1!==e.indexOf(t);var n=!1;return u(e,function(e){e===t&&(n=!0)}),n},c.indexOf=function(e,t){if(Array.prototype.indexOf===e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},c.uniq=function(e){var t=[];return u(e,function(e){c.contains(t,e)||t.push(e)}),t},c.find=function(e,n,r){var o,s=c.isFunction(n);if(e)for(var i=0,u=e.length;u>i;i++){var a=e[i];if(s?n.call(r,a):t(n,a)){o=a;break}}return o},c.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},c.flatten=function(e){var t=[];return u(e,function(e){c.isArray(e)&&Array.prototype.push.apply(t,e)}),t},c.flatMap=c.compose(c.flatten,c.map),c.union=function(){return c.uniq(c.flatten(arguments))},c.findOrFirst=function(e,t){var n=c.find(e,t);return c.isUndefined(n)?e[0]:n},c.extend=function(e){return e=e||{},u(Array.prototype.slice.call(arguments,1),function(t){t&&u(t,function(t,n){e[n]=t})}),e},c.deleteProperties=function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]},c.clonePartial=function(e,t){var n;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return n=new Date,n.setTime(e.getTime()),n;if(e instanceof Array){n=[];for(var r=0,o=e.length;o>r;r++)(!t||t(r))&&n.push(c.clonePartial(e[r],t));return n}if(e instanceof Object){n=Object.create(Object.getPrototypeOf(e));for(var s in e)!e.hasOwnProperty(s)||t&&!t(s)||(n[s]=c.clonePartial(e[s],t));return n}throw new Error("Unable to copy obj")},c.partialRight=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,Array.prototype.slice.call(arguments).concat(t))}},c.partial=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}},c.maybe=function(e){return null!=e?e:{}},c.objectExtender=function(e,t){return function(n){return n&&(t?u(t(n),function(t){c.extend(t,c.isFunction(e)?e(n,t):e)}):c.extend(n,c.isFunction(e)?e(n,n):e)),n}},c.constructorSetter=function(e,t,n){var r;return n?(r=c.constructorSetter(e,t),function(e){if(c.isObject(e)){var t=n(e);c.isArray(t)?c.forEach(t,function(e){r(e)}):c.isObject(t)&&r(t)}return e}):t?(r=c.constructorSetter(e),function(e){return c.isObject(e)&&(c.isArray(e[t])?e[t]=c.map(e[t],function(e){return r(e)}):c.isObject(e[t])&&(e[t]=r(e[t]))),e}):function(t){var n=Object.create(e.prototype);return c.extend(n,t),n}},c.wrapFunctions=function(e,t,n){return u(n,function(n){e[n]=function(){return t[n].apply(t,arguments)}}),e},c.extendHttpPromise=function(e,t){return c.wrapFunctions(e,t,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])},c.chainHttpPromises=function(){var e=arguments[0],t={};return u(Array.prototype.slice.call(arguments,1),function(n){e=e.then(function(){var e=n.apply(null,arguments);return e&&e.then&&c.extendHttpPromise(t,e),e})}),c.extendHttpPromise(e,t),e},c.removeEmptyProperties=function(e){return u(e,function(t,n){(null==t||""===t)&&delete e[n]}),e},c.getLastUrlSegment=function(e){return e&&(e=e.replace(/^.*\//,"").replace(/\?.*$/,"")),e},c.getResponseEntityId=function(e,t){return t.getResponseHeader("X-ENTITY-ID")},c.getResponseLocation=function(e,t){return c.removeAccessToken(t.getResponseHeader("Location"))},c.getLastResponseLocationSegment=function(e,t){return c.getLastUrlSegment(t.getResponseHeader("Location"))},c.isAbsoluteUrl=function(e){return/^https?:\/\//.test(e)},c.isOAuthServerUrl=function(t){return 0===t.indexOf(e.oauthServer[e.environment])},c.getAPIServerUrl=function(t){return n(e.apiServer[e.environment],t)},c.isAuthoritiesServerUrl=function(e){return-1!==e.indexOf("/authorities/v1/")},c.getAuthoritiesServerUrl=function(t){return n(e.authoritiesServer[e.environment],t)},c.encodeQueryString=function(e){var t=[];return u(e,function(e,n){var r=encodeURIComponent(n);null!=e&&(r+="="+encodeURIComponent(e)),t.push(r)}),t.join("&")},c.appendQueryParameters=function(e,t){var n=c.encodeQueryString(t);return 0===n.length?e:e+(e.indexOf("?")>=0?"&":"?")+n},c.decodeQueryString=function(e){var t={};if(e){var n=e.indexOf("?");if(-1!==n){var r=e.substring(n+1).split("&");u(r,function(e){var n=e.split("=",2);n&&n[0]&&(t[decodeURIComponent(n[0])]=null!=n[1]?decodeURIComponent(n[1]):n[1])})}}return t},c.removeQueryString=function(e){if(e){var t=e.indexOf("?");-1!==t&&(e=e.substring(0,t))}return e},c.appendAccessToken=function(t){if(t){var n=c.decodeQueryString(t);t=c.removeQueryString(t),n.access_token=e.accessToken,t=c.appendQueryParameters(t,n)}return t},c.removeAccessToken=function(e){if(e){var t=c.decodeQueryString(e);e=c.removeQueryString(e),delete t.access_token,e=c.appendQueryParameters(e,t)}return e},c.populateUriTemplate=function(e,t){for(var n=e.split(/[{}]/),r=!1,o=0,s=n.length;s>o;o++)if(o%2===1){var i=t[n[o]];n[o]=r?encodeURIComponent(i):encodeURI(i)}else-1!==n[o].indexOf("?")&&(r=!0);return n.join("")},c.nextTick=function(t){e.setTimeout(function(){t()},0)},c.refPromise=function(t){return t&&c.isFunction(t.then)?t:{then:function(n){var r=e.deferredWrapper();return c.nextTick(function(){r.resolve(n(t))}),r.promise}}},c.promiseAll=function(t){var n=e.deferredWrapper(),r=0,o=c.isArray(t)?[]:{};return u(t,function(e,t){r++,c.refPromise(e).then(function(e){o.hasOwnProperty(t)||(o[t]=e,--r||n.resolve(o))},function(){o.hasOwnProperty(t)||n.reject.apply(n,arguments)})}),0===r&&n.resolve(o),n.promise},c.createCookie=function(e,t,n){var r="",o="localhost"!==document.location.hostname;if(n){var s=new Date;s.setTime(s.getTime()+86400*n),r="; expires="+s.toUTCString()}document.cookie=e+"="+t+r+"; path=/"+(o?"; secure":"")},c.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},c.eraseCookie=function(e){c.createCookie(e,"",-1)};var a=null,p=null;return c.readAccessToken=function(){var t=(new Date).getTime(),n=c.readCookie(e.accessTokenCookie);if(n){var r=n.split("|",3);if(3===r.length){var i=t-parseInt(r[0],10),u=t-parseInt(r[1],10);i<e.maxAccessTokenInactivityTime&&u<e.maxAccessTokenCreationTime&&(e.accessToken=r[2],e.autoExpire&&(o(e.maxAccessTokenInactivityTime-i),s(e.maxAccessTokenCreationTime-u)))}}},c.setAccessToken=function(t){if(e.accessToken=t,e.autoExpire&&(o(e.maxAccessTokenInactivityTime),s(e.maxAccessTokenCreationTime)),e.saveAccessToken){var n=(new Date).getTime(),r=n+"|"+n+"|"+t;c.createCookie(e.accessTokenCookie,r,0)}},c.refreshAccessToken=function(){var t=(new Date).getTime();if(e.autoExpire&&o(e.maxAccessTokenInactivityTime),e.saveAccessToken){var n=c.readCookie(e.accessTokenCookie);if(n){var r=n.split("|",3);3===r.length&&(n=t+"|"+r[1]+"|"+r[2],c.createCookie(e.accessTokenCookie,n,0))}}},c.eraseAccessToken=function(){e.accessToken=null,e.autoExpire&&i(),e.saveAccessToken&&c.eraseCookie(e.accessTokenCookie)},c}),e("angularjs-wrappers",["globals","helpers"],function(e,t){var n={};return n.httpWrapper=function(n){return function(r,o,s,i,c){var u=t.extend({method:r,url:o,responseType:"json",data:i,transformRequest:function(e){return e}},c);u.headers=t.extend({},s,c.headers),"multipart/form-data"===u.headers["Content-Type"]&&(u.headers["Content-Type"]=void 0);var a=n(u),p=e.deferredWrapper(),f=p.promise,l=null,h=null;return a.then(function(e){l=e.status,h=e.headers,p.resolve(e.data)},function(e){l=e.status,h=e.headers,p.reject(e)}),f.getStatusCode=function(){return l},f.getResponseHeader=function(e){return h(e)},f.getAllResponseHeaders=function(){return h()},f.getRequest=function(){return u},f}},n.deferredWrapper=function(e){return function(){var t=e();return{promise:t.promise,resolve:t.resolve,reject:t.reject}}},n}),e("jquery-wrappers",["globals","helpers"],function(e,t){var n={};return n.httpWrapper=function(n){return function(r,o,s,i,c){c=t.extend({url:o,type:r,dataType:"json",data:i,processData:!1},c),c.headers=t.extend({},s,c.headers),"multipart/form-data"===c.headers["Content-Type"]&&(c.contentType=!1,delete c.headers["Content-Type"]);var u=n(c),a=e.deferredWrapper(),p=a.promise,f=null;return u.then(function(e,t,n){f=n.status,a.resolve(e)},function(e,t,n){f=e.status,e.responseText?a.reject(e,t,n):a.resolve(null)}),t.wrapFunctions(p,u,["getResponseHeader","getAllResponseHeaders"]),p.getStatusCode=function(){return f},p.getRequest=function(){return c},p}},n.deferredWrapper=function(e){return function(){var t=e();return{promise:t.promise(),resolve:t.resolve,reject:t.reject}}},n}),e("plumbing",["globals","helpers"],function(e,t){function n(e){var t,r,o,s,i,c,u,a="";for(t in e)if(e.hasOwnProperty(t))if(r=e[t],r instanceof Array)for(u=0;u<r.length;++u)i=r[u],o=t+"["+u+"]",c={},c[o]=i,a+=n(c)+"&";else if(r instanceof Object)for(s in r)r.hasOwnProperty(s)&&(i=r[s],o=t+"["+s+"]",c={},c[o]=i,a+=n(c)+"&");else void 0!==r&&null!==r&&(a+=encodeURIComponent(t)+"="+encodeURIComponent(r)+"&");return a.length?a.substr(0,a.length-1):a}function r(e,r){if(e&&t.isObject(e)&&"[object FormData]"!==String(e)){if("application/x-www-form-urlencoded"===r)return n(e);if(r&&-1!==r.indexOf("json"))return JSON.stringify(e)}return e}var o=0,s={};return s.getTotalProcessingTime=function(){return o},s.setTotalProcessingTime=function(e){o=e},s.getUrl=function(n,r,o){return e.discoveryPromise.then(function(e){var s="",i=e.links[n];if(t.isAbsoluteUrl(r))s=r;else if(i.href)s=t.removeAccessToken(i.href);else if(i.template){var c=i.template.replace(/{\?[^}]*}/,"");s=t.populateUriTemplate(c,o||{})}return s})},s.get=function(e,n,r,o,i){return s.http("GET",t.appendQueryParameters(e,n),t.extend({Accept:"application/x-gedcomx-v1+json"},r),null,o,i)},s.post=function(e,n,r,o,i){return s.http("POST",e,t.extend({"Content-Type":"application/x-gedcomx-v1+json"},r),n,o,i)},s.put=function(e,n,r,o,i){return s.http("PUT",e,t.extend({"Content-Type":"application/x-gedcomx-v1+json"},r),n,o,i)},s.del=function(e,t,n,r){return s.http("DELETE",e,t,{},n,r)},s.http=function(n,i,c,u,a,p,f){var l=e.deferredWrapper(),h=l.promise,g=t.getAPIServerUrl(i);c=c||{};var d;return d=e.accessToken||!e.autoSignin||t.isOAuthServerUrl(g)||i===e.discoveryUrl?t.refPromise(e.accessToken):e.getAccessToken(),d.then(function(){var d=t.isAuthoritiesServerUrl(g)?"sessionId":"access_token";if(e.accessToken&&-1===g.indexOf(d+"=")){var m={};m[d]=e.accessToken,g=t.appendQueryParameters(g,m)}null==f&&(f=e.maxHttpRequestRetries),u&&(u=t.clonePartial(u,function(e){return!(t.isString(e)&&("$"===e.charAt(0)||"_"===e.charAt(0)))}));var y=e.httpWrapper(n,g,c,r(u,c["Content-Type"]),a||{});t.extendHttpPromise(h,y),y.then(function(e){t.refreshAccessToken();var n=y.getResponseHeader("X-PROCESSING-TIME");n&&(o+=parseInt(n,10)),p&&(e=p(e,y)),l.resolve(e)},function(){var r=y.getStatusCode();if(console.log("http failure",r,f,y.getAllResponseHeaders()),401===r&&t.eraseAccessToken(),"GET"===n&&r>=500&&f>0||429===r){var o=y.getResponseHeader("Retry-After"),g=o?parseInt(o,10):e.defaultThrottleRetryAfter;e.setTimeout(function(){y=s.http(n,i,c,u,a,p,f-1),t.extendHttpPromise(h,y),y.then(function(e){l.resolve(e)},function(){l.reject.apply(l,arguments)})},g)}else l.reject.apply(l,arguments)})},function(){l.reject.apply(l,arguments)}),h},s}),e("init",["angularjs-wrappers","globals","helpers","jquery-wrappers","plumbing"],function(e,t,n,r,o){var s={};return s.init=function(s){if(s=s||{},!s.app_key)throw"app_key must be set";if(t.appKey=s.app_key,!s.environment)throw"environment must be set";if(t.environment=s.environment,!s.http_function)throw"http must be set; e.g., jQuery.ajax";var i=s.http_function;if(t.httpWrapper=i.defaults?e.httpWrapper(i):r.httpWrapper(i),!s.deferred_function)throw"deferred_function must be set; e.g., jQuery.Deferred";var c=s.deferred_function,u=c();u.resolve(),t.deferredWrapper=n.isFunction(u.promise)?r.deferredWrapper(c):e.deferredWrapper(c);var a=s.timeout_function;a?(t.setTimeout=function(e,t){return a(e,t)},t.clearTimeout=function(e){a.cancel(e)}):(t.setTimeout=function(e,t){return setTimeout(e,t)},t.clearTimeout=function(e){clearTimeout(e)}),t.authCallbackUri=s.auth_callback,t.autoSignin=s.auto_signin,t.autoExpire=s.auto_expire,s.save_access_token&&(t.saveAccessToken=!0,n.readAccessToken()),s.access_token&&(t.accessToken=s.access_token),t.discoveryPromise=o.get(t.discoveryUrl)},s}),e("authentication",["globals","helpers","plumbing"],function(e,t,n){function r(e,n){e.then(function(e){var r=e.access_token;r?(t.setAccessToken(r),n.resolve(r)):n.reject(e.error)},function(){n.reject.apply(n,arguments)})}function o(e,n){var r=t.isUndefined(window.screenX)?window.screenLeft:window.screenX,o=t.isUndefined(window.screenY)?window.screenTop:window.screenY,s=t.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,i=t.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,c=n.width||780,u=n.height||500,a=parseInt(r+(s-c)/2,10),p=parseInt(o+(i-u)/2.5,10),f="width="+c+",height="+u+",left="+a+",top="+p;return window.open(t.appendQueryParameters(e,n),"",f)}function s(n){var r=e.deferredWrapper();if(n)var o=setInterval(function(){try{if(n.location.hostname===window.location.hostname){var e=t.decodeQueryString(n.location.href);clearInterval(o),n.close(),e.code?r.resolve(e.code):r.reject(e.error)}}catch(s){}},e.authCodePollDelay);else r.reject("Popup blocked");return r.promise}var i={};return i.getAuthCode=function(){return n.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(t){var n=o(t,{response_type:"code",client_id:e.appKey,redirect_uri:e.authCallbackUri});return s(n)})},e.getAccessToken=i.getAccessToken=function(o){var s=e.deferredWrapper();if(e.accessToken)t.nextTick(function(){s.resolve(e.accessToken)});else{var c;c=o?t.refPromise(o):i.getAuthCode(),c.then(function(t){n.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(o){var i=n.post(o,{grant_type:"authorization_code",code:t,client_id:e.appKey},{"Content-Type":"application/x-www-form-urlencoded"});r(i,s)})},function(){s.reject.apply(s,arguments)})}return s.promise},i.getAccessTokenForMobile=function(t,o){var s=e.deferredWrapper();return n.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(i){var c=n.post(i,{grant_type:"password",client_id:e.appKey,username:t,password:o},{"Content-Type":"application/x-www-form-urlencoded"});r(c,s)}),s.promise},i.hasAccessToken=function(){return!!e.accessToken},i.invalidateAccessToken=function(){return t.eraseAccessToken(),t.chainHttpPromises(n.getUrl("http://oauth.net/core/2.0/endpoint/token"),function(e){return n.del(e)})},i}),e("authorities",["helpers","plumbing"],function(e,t){var n=e.maybe,r={},o=r.Date=function(){},s=r.constructFormalDate=function(e,t){var n,r="",o="",s="",i="",c="+",u=0;"about"===e[u]?(t||(r="A"),u++):"before"===e[u]?(t||(r="A/"),u++):"after"===e[u]&&(t||(r="A",o="/"),u++),e[u].length<=2&&(s=(1===e[u].length?"0":"")+e[u],u++);var a=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(e[u])+1;return a>0&&(i=(10>a?"0":"")+a.toString(),u++),n=e[u],u++,u<e.length&&"bc"===e[u]&&(c="-"),r+c+n+(i?"-":"")+i+(s?"-":"")+s+o};r.Date.prototype={constructor:o,$getFormalDate:function(){var e="";if(this.normalized){var t=this.normalized.trim().toLowerCase().split(" "),n=t.indexOf("/");n>=0&&(t=t.slice(0,n)),"from"===t[0]?(n=t.indexOf("to"),e=s(t.slice(1,n),!0)+"/"+s(t.slice(n+1),!0)):e=s(t,!1)}return e}};var i=r.Place=function(){};return r.Place.prototype={constructor:i,$getNormalizedPlace:function(){return n(this.normalized)[0]}},r.getDate=function(r,s){var i={date:r,dataFormat:"application/json"};return t.get(e.getAuthoritiesServerUrl("/authorities/v1/date"),i,{Accept:"application/json"},s,e.compose(e.objectExtender({getDate:function(){return n(n(this.dates).date)[0]}}),e.constructorSetter(o,"date",function(e){return e.dates})))},r.getPlace=function(r,o){var s={place:r,view:"simple",dataFormat:"application/json"};return t.get(e.getAuthoritiesServerUrl("/authorities/v1/place"),s,{Accept:"application/json"},o,e.compose(e.objectExtender({getPlaces:function(){return n(this.places).place}}),e.constructorSetter(i,"place",function(e){return e.places})))},r}),e("user",["globals","helpers","plumbing"],function(e,t,n){var r=t.maybe,o={},s=o.User=function(){};o.User.prototype={constructor:s};var i=o.Agent=function(){};return o.Agent.prototype={constructor:i,$getName:function(){return r(r(this.names)[0]).value},$getAccountName:function(){return r(r(this.accounts)[0]).accountName},$getEmail:function(){var e=r(r(this.emails)[0]).resource;return e?e.replace(/^mailto:/,""):e}},o.getCurrentUser=function(e,o){return t.chainHttpPromises(n.getUrl("current-user"),function(i){return n.get(i,e,{},o,t.compose(t.objectExtender({getUser:function(){return r(this.users)[0]}}),t.constructorSetter(s,"users")))})},o.getCurrentUserPersonId=function(e,t){return n.getUrl("current-user-person").then(function(o){return n.get(o+".json",e,{},t).then(function(e){return r(r(r(e).persons)[0]).id})})},o.getAgent=function(e,o,s){return t.chainHttpPromises(n.getUrl("agent-template",e,{uid:e}),function(e){return n.get(e,o,{},s,t.compose(t.objectExtender({getAgent:function(){return r(this.agents)[0]}}),t.constructorSetter(i,"agents")))})},o.getMultiAgent=function(e,n,r){var s={};return t.forEach(e,function(e){s[e]=o.getAgent(e,n,r)}),t.promiseAll(s)},o}),e("changeHistory",["helpers","plumbing","user"],function(e,t,n){var r=e.maybe,o={},s=o.Change=function(){};o.Change.prototype={constructor:s,$getAgentName:function(){return r(r(this.contributors)[0]).name},$getChangeReason:function(){return r(r(this.changeInfo)[0]).reason},$getAgentUrl:function(){return e.removeAccessToken(this.links.agent.href)},$getAgent:function(){return n.getAgent(this.$getAgentUrl())}};var i=e.compose(e.objectExtender({getChanges:function(){return this.entries||[]}}),e.constructorSetter(s,"entries"));return o.getPersonChanges=function(n,r,o){return e.chainHttpPromises(t.getUrl("person-changes-template",n,{pid:n}),function(e){return t.get(e,r,{Accept:"application/x-gedcomx-atom+json"},o,i)})},o.getChildAndParentsChanges=function(n,r,o){return e.chainHttpPromises(t.getUrl("child-and-parents-relationship-changes-template",n,{caprid:n}),function(e){return t.get(e,r,{Accept:"application/x-gedcomx-atom+json"},o,i)})},o.getCoupleChanges=function(n,r,o){return e.chainHttpPromises(t.getUrl("couple-relationship-changes-template",n,{crid:n}),function(e){return t.get(e,r,{Accept:"application/x-gedcomx-atom+json"},o,i)})},o}),e("discussions",["helpers","plumbing","user"],function(e,t,n){var r=e.maybe,o={},s=o.Discussion=function(){};o.Discussion.prototype={constructor:s,$getCommentsUrl:function(){return e.removeAccessToken(r(r(this.links).comments).href)},$getComments:function(){return o.getComments(this.$getCommentsUrl())},$getAgentId:function(){return r(this.contributor).resourceId},$getAgentUrl:function(){return e.removeAccessToken(r(this.contributor).resource)},$getAgent:function(){return n.getAgent(this.$getAgentUrl())}};var i=o.DiscussionRef=function(){};o.DiscussionRef.prototype={constructor:i,$getDiscussionUrl:function(){return e.removeAccessToken(this.resource)},$getDiscussion:function(){return o.getDiscussion(this.$getDiscussionUrl())}};var c=o.Comment=function(){};return o.Comment.prototype={constructor:c,$getAgentId:function(){return r(this.contributor).resourceId},$getAgentUrl:function(){return e.removeAccessToken(r(this.contributor).resource)},$getAgent:function(){return n.getAgent(this.$getAgentUrl())}},o.getDiscussion=function(n,o,i){return e.chainHttpPromises(t.getUrl("discussion-template",n,{did:n}),function(n){return t.get(n,o,{Accept:"application/x-fs-v1+json"},i,e.compose(e.objectExtender({getDiscussion:function(){return r(r(this).discussions)[0]}}),e.constructorSetter(s,"discussions")))})},o.getMultiDiscussion=function(t,n,r){var s={};return e.forEach(t,function(e){var t,c;e instanceof i?(c=e.$getDiscussionUrl(),t=c):(c=e,t=e),s[t]=o.getDiscussion(c,n,r)}),e.promiseAll(s)},o.getPersonDiscussionRefs=function(n,o,s){return e.chainHttpPromises(t.getUrl("person-discussion-references-template",n,{pid:n}),function(n){return t.get(n,o,{Accept:"application/x-fs-v1+json","X-FS-Feature-Tag":"discussion-reference-json-fix"},s,e.compose(e.objectExtender({getDiscussionRefs:function(){return r(r(r(this).persons)[0])["discussion-references"]||[]}}),e.constructorSetter(i,"discussion-references",function(e){return r(r(e).persons)[0]}),e.objectExtender(function(e){return{$personId:r(r(r(e).persons)[0]).id}},function(e){return r(r(r(e).persons)[0])["discussion-references"]})))})},o.getComments=function(n,o,s){return e.chainHttpPromises(t.getUrl("discussion-comments-template",n,{did:n}),function(n){return t.get(n,o,{Accept:"application/x-fs-v1+json"},s,e.compose(e.objectExtender({getComments:function(){return r(r(r(this).discussions)[0]).comments||[]}}),e.constructorSetter(c,"comments",function(e){return r(r(e).discussions)[0]}),e.objectExtender(function(e){return{$discussionId:r(r(r(e).discussions)[0]).id}},function(e){return r(r(r(e).discussions)[0]).comments})))})},o}),e("attribution",["helpers","plumbing","user"],function(e,t,n){var r=e.maybe,o={},s=o.Attribution=function(e){e&&(this.changeMessage=e)};return o.Attribution.prototype={constructor:s,$getAgentId:function(){return r(this.contributor).resourceId},$getAgentUrl:function(){return e.removeAccessToken(r(this.contributor).resource)},$getAgent:function(){return n.getAgent(this.$getAgentUrl())}},o}),e("fact",["attribution","authorities","helpers"],function(e,t,n){var r=n.maybe,o={},s=o.Fact=function(e){e&&(e.type&&this.$setType(e.type),e.date&&this.$setDate(e.date),e.formalDate&&this.$setFormalDate(e.formalDate),e.place&&this.$setPlace(e.place),e.normalizedPlace&&this.$setNormalizedPlace(e.normalizedPlace),e.normalizedPlaceId&&this.$setNormalizedPlaceId(e.normalizedPlaceId),e.changeMessage&&this.$setChangeMessage(e.changeMessage))};return o.Fact.prototype={constructor:s,$getDate:function(){return r(this.date).original},$getFormalDate:function(){return r(this.date).formal},$getPlace:function(){return r(this.place).original},$getNormalizedPlace:function(){return r(r(this.place).normalized).value},$getNormalizedPlaceId:function(){var e=r(this.place).description;return e&&"#"===e.charAt(0)?e.substr(1):""},$setType:function(e){return this.$changed=!0,this.type=e,this},$setDate:function(e){return this.$changed=!0,this.date||(this.date={}),n.isString(e)?this.date.original=e:e instanceof t.Date?(this.date.original=e.original,this.$setFormalDate(e.$getFormalDate())):n.isObject(e)&&(this.date.original=e.date,this.$setFormalDate(e.formalDate)),this},$setFormalDate:function(e){return this.$changed=!0,this.date||(this.date={}),this.date.formal=e,this},$setPlace:function(e){return this.$changed=!0,this.place||(this.place={}),n.isString(e)?this.place.original=e:e instanceof t.Place?(this.place.original=e.original,this.$setNormalizedPlace(e.$getNormalizedPlace()),this.$setNormalizedPlaceId(e.id)):n.isObject(e)&&(this.place.original=e.place,this.$setNormalizedPlace(e.normalizedPlace),this.$setNormalizedPlaceId(e.normalizedPlaceId)),this},$setNormalizedPlace:function(e){return this.$changed=!0,this.place||(this.place={}),this.place.normalized={value:e},this},$setNormalizedPlaceId:function(e){return this.$changed=!0,this.place.description="#"+e,this},$setChangeMessage:function(t){return this.attribution=new e.Attribution(t),this}},o}),e("name",["attribution","helpers"],function(e,t){function n(e,n){var r=n||0;for(t.isArray(e.nameForms)||(e.nameForms=[]);r>=e.nameForms.length;)e.nameForms.push({});return e.nameForms[r]}var r=t.maybe,o={},s=o.Name=function(e){e&&(t.isString(e)?this.$setFullText(e):(e.type&&this.$setType(e.type),e.givenName&&this.$setGivenName(e.givenName),e.surname&&this.$setSurname(e.surname),e.prefix&&this.$setPrefix(e.prefix),e.suffix&&this.$setSuffix(e.suffix),e.fullText&&this.$setFullText(e.fullText),this.$setPreferred(!!e.preferred),e.changeMessage&&this.$setChangeMessage(e.changeMessage)))};return o.Name.prototype={constructor:s,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getFullText:function(e){return r(r(this.nameForms)[e||0]).fullText},$getNamePart:function(e,n){return r(t.find(r(r(this.nameForms)[n||0]).parts,{type:e})).value},$getGivenName:function(e){return this.$getNamePart("http://gedcomx.org/Given",e)},$getSurname:function(e){return this.$getNamePart("http://gedcomx.org/Surname",e)},$getPrefix:function(e){return this.$getNamePart("http://gedcomx.org/Prefix",e)},$getSuffix:function(e){return this.$getNamePart("http://gedcomx.org/Suffix",e)},$setType:function(e){return this.$changed=!0,this.type=e,this},$setPreferred:function(e){return this.$changed=!0,this.preferred=e,this},$setFullText:function(e,t){this.$changed=!0;var r=n(this,t);return r.fullText=e,this},$setNamePart:function(e,r,o){this.$changed=!0;var s=n(this,o);t.isArray(s.parts)||(s.parts=[]);var i=t.find(s.parts,{type:r});return i||(i={type:r},s.parts.push(i)),i.value=e,this},$setGivenName:function(e,t){return this.$setNamePart(e,"http://gedcomx.org/Given",t)},$setSurname:function(e,t){return this.$setNamePart(e,"http://gedcomx.org/Surname",t)},$setPrefix:function(e,t){return this.$setNamePart(e,"http://gedcomx.org/Prefix",t)},$setSuffix:function(e,t){return this.$setNamePart(e,"http://gedcomx.org/Suffix",t)},$setChangeMessage:function(t){return this.attribution=new e.Attribution(t),this}},o}),e("memories",["attribution","discussions","globals","helpers","name","plumbing"],function(e,t,n,r,o,s){var i=r.maybe,c={},u=c.Memory=function(){};c.Memory.prototype={constructor:u,$getTitle:function(){return i(i(this.titles)[0]).value},$getDescription:function(){return i(i(this.description)[0]).value},$getIconUrl:function(){return r.appendAccessToken(i(i(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return r.appendAccessToken(i(i(this.links)["image-thumbnail"]).href)},$getImageUrl:function(){return r.appendAccessToken(i(i(this.links).image).href)},$addMemoryPersona:function(e,t,n){return c.addMemoryPersona(this.id,e,t,n)}};var a=c.MemoryPersona=function(e,t){this.names=[],this.media=[],e&&this.$addName(e),t&&this.$addMemoryArtifactRef(t)};c.MemoryPersona.prototype={constructor:a,$getMemoryArtifactRef:function(){return i(this.media)[0]},$getNames:function(){return this.names||[]},$getDisplayName:function(){return i(this.display).name},$getPreferredName:function(){return r.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var e=this.$getPreferredName();return e&&(e=e.$getGivenName()),e},$getSurname:function(){var e=this.$getPreferredName();return e&&(e=e.$getSurname()),e},$addName:function(e){e instanceof o.Name||(e=new o.Name(e)),this.names.push(e)},$addMemoryArtifactRef:function(e){e instanceof f||(e=new f(e)),this.media.push(e)}};var p=c.MemoryPersonaRef=function(e){this.resource=r.removeAccessToken(e),this.resourceId=r.getLastUrlSegment(this.resource)};c.MemoryPersonaRef.prototype={constructor:p,$getMemoryId:function(){return this.resource?this.resource.replace(/^.*\/memories\/([^\/]*)\/personas\/.*$/,"$1"):this.resource},$getMemoryUrl:function(){return this.resource?r.removeAccessToken(this.resource.replace(/(^.*\/memories\/[^\/]*)\/personas\/.*$/,"$1")):this.resource},$getMemory:function(){return c.getMemory(this.$getMemoryUrl())}};var f=c.MemoryArtifactRef=function(e){this.description=e};return c.MemoryArtifactRef.prototype={constructor:f,$getMemoryArtifactUrl:function(){return r.appendAccessToken(this.description)},$setMemoryArtifactUrl:function(e){this.description=e}},c.getPersonMemoriesQuery=function(t,n,o){return r.chainHttpPromises(s.getUrl("person-memories-query",t,{pid:t}),function(t){return s.get(t,n,{},o,r.compose(r.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),r.constructorSetter(u,"sourceDescriptions"),r.constructorSetter(e.Attribution,"attribution",function(e){return e.sourceDescriptions})))})},c.getUserMemoriesQuery=function(t,n,o){return r.chainHttpPromises(s.getUrl("user-memories-query",t,{cisUserId:t}),function(t){return s.get(t,n,{},o,r.compose(r.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),r.constructorSetter(u,"sourceDescriptions"),r.constructorSetter(e.Attribution,"attribution",function(e){return e.sourceDescriptions})))})},c.getMemory=function(t,n,o){return r.chainHttpPromises(s.getUrl("memory-template",t,{mid:t}),function(t){return s.get(t,n,{},o,r.compose(r.objectExtender({getMemory:function(){return i(this.sourceDescriptions)[0]
}}),r.constructorSetter(u,"sourceDescriptions"),r.constructorSetter(e.Attribution,"attribution",function(e){return e.sourceDescriptions})))})},c.getMemoryComments=function(e,n,o){return r.chainHttpPromises(s.getUrl("memory-comments-template",e,{mid:e}),function(e){return s.get(e,n,{Accept:"application/x-fs-v1+json"},o,r.compose(r.objectExtender({getComments:function(){return i(i(this.discussions)[0]).comments||[]}}),r.constructorSetter(t.Comment,"comments",function(e){return i(i(e).discussions)[0]}),r.objectExtender(function(e,t){var n=i(i(i(t).links).comment).href;return{$memoryId:n?r.removeAccessToken(n.replace(/^.*\/memories\/([^\/]*)\/comments\/.*$/,"$1")):n}},function(e){return i(i(i(e).discussions)[0]).comments})))})},c.getMemoryPersonas=function(e,t,n){return r.chainHttpPromises(s.getUrl("memory-personas-template",e,{mid:e}),function(e){return s.get(e,t,{},n,r.compose(r.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),r.constructorSetter(a,"persons"),r.constructorSetter(o.Name,"names",function(e){return i(e).persons}),r.constructorSetter(f,"media",function(e){return i(e).persons}),r.objectExtender(function(e,t){var n=i(i(i(t).links).persona).href;return{$memoryId:n?r.removeAccessToken(n.replace(/^.*\/memories\/([^\/]*)\/personas\/.*$/,"$1")):n}},function(e){return i(e).persons})))})},c.getMemoryPersonaRefs=function(e,t,n){var o=r.isAbsoluteUrl(e)?e:"/platform/tree/persons/"+encodeURI(e)+"/memory-references";return s.get(o,t,{},n,r.compose(r.objectExtender({getMemoryPersonaRefs:function(){return i(i(this.persons)[0]).evidence||[]}}),r.constructorSetter(p,"evidence",function(e){return i(i(e).persons)[0]}),r.objectExtender(function(e){return{$personId:i(i(i(e).persons)[0]).id}},function(e){return i(i(i(e).persons)[0]).evidence})))},c.getPersonPortraitUrl=function(e,t,o){return s.getUrl("person-portrait-template",e,{pid:e}).then(function(e){if(t&&t.followRedirect){t=r.extend({},t),delete t.followRedirect;var i=n.deferredWrapper(),c=s.get(e,t,{},o),u=function(){i.resolve(200===c.getStatusCode()?r.appendAccessToken(c.getResponseHeader("Content-Location")):"")};return c.then(u,u),r.extendHttpPromise(i.promise,c)}return r.appendAccessToken(e)})},c.createMemory=function(e,t,n){return r.chainHttpPromises(s.getUrl("memories"),function(o){return s.post(r.appendQueryParameters(o,t),e,{"Content-Type":r.isString(e)?"text/plain":"multipart/form-data"},n,r.getResponseLocation)})},c.addMemoryPersona=function(e,t,n,o){var i={persons:[t]};return r.chainHttpPromises(s.getUrl("memory-personas-template",e,{mid:e}),function(e){return s.post(e,i,{},o,function(e,t){var n=t.getResponseHeader("Location");return n?new p(n):n})})},c.addMemoryPersonaRef=function(t,n,o,i){var c=new e.Attribution;o&&o.changeMessage&&(c.changeMessage=o.changeMessage);var u={persons:[{evidence:[n],attribution:c}]};return r.chainHttpPromises(s.getUrl("person-memory-persona-references-template",t,{pid:t}),function(e){return s.post(e,u,{},i,r.getResponseLocation)})},c}),e("notes",["attribution","helpers","plumbing"],function(e,t,n){function r(e){if(e){if(e.persons)return e.persons;if(e.childAndParentsRelationships)return e.childAndParentsRelationships;if(e.relationships)return e.relationships}return{}}function o(o,s,c){return n.get(o,s,{Accept:"application/x-fs-v1+json"},c,t.compose(t.objectExtender({getNote:function(){return i(i(r(this)[0]).notes)[0]}}),t.constructorSetter(u,"notes",function(e){return r(e)[0]}),t.constructorSetter(e.Attribution,"attribution",function(e){return i(r(e)[0]).notes})))}function s(e,n,r,o,s){var i={};return t.isArray(e)?t.forEach(e,function(e){var t,n;e instanceof a?(t=e.id,n=e.$getNoteUrl()):(t=e,n=e),i[t]=s(n,null,r,o)}):t.forEach(n,function(t){i[t]=s(e,t,r,o)}),i}var i=t.maybe,c={},u=c.Note=function(){};c.Note.prototype={constructor:u};var a=c.NoteRef=function(){};return c.NoteRef.prototype={constructor:a,$getNoteUrl:function(){var e=t.removeAccessToken(this.links.note.href);return-1===e.indexOf(this.id)&&(e+="/"+this.id),e},$getNote:function(){return o(this.$getNoteUrl())}},c.getPersonNoteRefs=function(e,r,o){return t.chainHttpPromises(n.getUrl("person-notes-template",e,{pid:e}),function(e){return n.get(e,r,{},o,t.compose(t.objectExtender({getNoteRefs:function(){return i(i(i(this).persons)[0]).notes||[]}}),t.constructorSetter(a,"notes",function(e){return i(i(e).persons)[0]}),t.objectExtender(function(e){return{$personId:i(i(i(e).persons)[0]).id}},function(e){return i(i(i(e).persons)[0]).notes})))})},c.getCoupleNoteRefs=function(e,r,o){return t.chainHttpPromises(n.getUrl("couple-relationship-notes-template",e,{crid:e}),function(e){return n.get(e,r,{},o,t.compose(t.objectExtender({getNoteRefs:function(){return i(i(this.relationships)[0]).notes||[]}}),t.constructorSetter(a,"notes",function(e){return i(i(e).relationships)[0]}),t.objectExtender(function(e){return{$coupleId:i(i(i(e).relationships)[0]).id}},function(e){return i(i(i(e).relationships)[0]).notes})))})},c.getChildAndParentsNoteRefs=function(e,r,o){return t.chainHttpPromises(n.getUrl("child-and-parents-relationship-notes-template",e,{caprid:e}),function(e){return n.get(e,r,{Accept:"application/x-fs-v1+json"},o,t.compose(t.objectExtender({getNoteRefs:function(){return i(i(this.childAndParentsRelationships)[0]).notes||[]}}),t.constructorSetter(a,"notes",function(e){return i(i(e).childAndParentsRelationships)[0]}),t.objectExtender(function(e){return{$childAndParentsId:i(i(i(e).childAndParentsRelationships)[0]).id}},function(e){return i(i(i(e).childAndParentsRelationships)[0]).notes})))})},c.getPersonNote=function(e,r,s,i){return e instanceof a&&(e=e.$getNoteUrl()),t.chainHttpPromises(n.getUrl("person-note-template",e,{pid:e,nid:r}),function(e){return o(e,s,i)})},c.getMultiPersonNote=function(e,n,r,o){var i=s(e,n,r,o,c.getPersonNote);return t.promiseAll(i)},c.getCoupleNote=function(e,r,s,i){return e instanceof a&&(e=e.$getNoteUrl()),t.chainHttpPromises(n.getUrl("couple-relationship-note-template",e,{crid:e,nid:r}),function(e){return o(e,s,i)})},c.getMultiCoupleNote=function(e,n,r,o){var i=s(e,n,r,o,c.getCoupleNote);return t.promiseAll(i)},c.getChildAndParentsNote=function(e,r,s,i){return e instanceof a&&(e=e.$getNoteUrl()),t.chainHttpPromises(n.getUrl("child-and-parents-relationship-note-template",e,{caprid:e,nid:r}),function(e){return o(e,s,i)})},c.getMultiChildAndParentsNote=function(e,n,r,o){var i=s(e,n,r,o,c.getChildAndParentsNote);return t.promiseAll(i)},c}),e("sources",["attribution","helpers","plumbing"],function(e,t,n){var r=t.maybe,o={},s=o.SourceDescription=function(){};o.SourceDescription.prototype={constructor:s,$getCitation:function(){return r(r(this.citations)[0]).value},$getTitle:function(){return r(r(this.titles)[0]).value},$getText:function(){return r(r(this.notes)[0]).text},$getSourceRefsQuery:function(){return o.getSourceRefsQuery(t.removeAccessToken(this.links["source-references-query"].href))}};var i=o.SourceRef=function(){};return o.SourceRef.prototype={constructor:i,$getSourceDescriptionUrl:function(){return t.removeAccessToken(this.description)},$getSourceDescription:function(){return o.getSourceDescription(this.$getSourceDescriptionUrl())},$getTagNames:function(){return t.map(this.tags,function(e){return e.resource})}},o.getPersonSourceRefs=function(o,s,c){return t.chainHttpPromises(n.getUrl("person-source-references-template",o,{pid:o}),function(o){return n.get(o,s,{},c,t.compose(t.objectExtender({getSourceRefs:function(){return r(r(this.persons)[0]).sources||[]}}),t.constructorSetter(i,"sources",function(e){return r(r(e).persons)[0]}),t.constructorSetter(e.Attribution,"attribution",function(e){return r(r(r(e).persons)[0]).sources}),t.objectExtender(function(e){return{$personId:r(r(r(e).persons)[0]).id}},function(e){return r(r(r(e).persons)[0]).sources})))})},o.getCoupleSourceRefs=function(o,s,c){return t.chainHttpPromises(n.getUrl("couple-relationship-source-references-template",o,{crid:o}),function(o){return n.get(o,s,{},c,t.compose(t.objectExtender({getSourceRefs:function(){return r(r(this.relationships)[0]).sources||[]}}),t.constructorSetter(i,"sources",function(e){return r(r(e).relationships)[0]}),t.constructorSetter(e.Attribution,"attribution",function(e){return r(r(r(e).relationships)[0]).sources}),t.objectExtender(function(e){return{$coupleId:r(r(r(e).relationships)[0]).id}},function(e){return r(r(r(e).relationships)[0]).sources})))})},o.getChildAndParentsSourceRefs=function(o,s,c){return t.chainHttpPromises(n.getUrl("child-and-parents-relationship-source-references-template",o,{caprid:o}),function(o){return n.get(o,s,{Accept:"application/x-fs-v1+json"},c,t.compose(t.objectExtender({getSourceRefs:function(){return r(r(this.childAndParentsRelationships)[0]).sources||[]}}),t.constructorSetter(i,"sources",function(e){return r(r(e).childAndParentsRelationships)[0]}),t.constructorSetter(e.Attribution,"attribution",function(e){return r(r(r(e).childAndParentsRelationships)[0]).sources}),t.objectExtender(function(e){return{$childAndParentsId:r(r(r(e).childAndParentsRelationships)[0]).id}},function(e){return r(r(r(e).childAndParentsRelationships)[0]).sources})))})},o.getSourceDescription=function(o,c,u){return o instanceof i&&(o=o.$getSourceDescriptionUrl()),t.chainHttpPromises(n.getUrl("source-description-template",o,{sdid:o}),function(o){return n.get(o,c,{},u,t.compose(t.objectExtender({getSourceDescription:function(){return r(this.sourceDescriptions)[0]}}),t.constructorSetter(s,"sourceDescriptions"),t.constructorSetter(e.Attribution,"attribution",function(e){return e.sourceDescriptions})))})},o.getMultiSourceDescription=function(e,n,r){var s={};return t.forEach(e,function(e){var t,c;e instanceof i?(t=e.$getSourceDescriptionUrl(),c=e.$getSourceDescriptionUrl()):(t=e,c=e),s[t]=o.getSourceDescription(c,n,r)}),t.promiseAll(s)},o.getSourceRefsQuery=function(o,s,c){var u=t.isAbsoluteUrl(o)?o:t.appendQueryParameters("/platform/tree/source-references",{source:o});return n.get(u,s,{Accept:"application/x-fs-v1+json"},c,t.compose(t.objectExtender({getPersonSourceRefs:function(){return t.flatMap(r(this.persons),function(e){return e.sources})}}),t.objectExtender({getCoupleSourceRefs:function(){return t.flatMap(r(this.relationships),function(e){return e.sources})}}),t.objectExtender({getChildAndParentsSourceRefs:function(){return t.flatMap(r(this.childAndParentsRelationships),function(e){return e.sources})}}),t.constructorSetter(i,"sources",function(e){return t.union(r(e).persons,r(e).relationships,r(e).childAndParentsRelationships)}),t.constructorSetter(e.Attribution,"attribution",function(e){var n=t.union(r(e).persons,r(e).relationships,r(e).childAndParentsRelationships);return t.flatMap(n,function(e){return e.sources})}),t.objectExtender(function(e,n){var o=t.find(r(e).persons,function(e){return!!t.find(r(e).sources,{id:n.id})});return{$personId:o.id}},function(e){return t.flatMap(r(e).persons,function(e){return e.sources})}),t.objectExtender(function(e,n){var o=t.find(r(e).relationships,function(e){return!!t.find(r(e).sources,{id:n.id})});return{$coupleId:o.id}},function(e){return t.flatMap(r(e).relationships,function(e){return e.sources})}),t.objectExtender(function(e,n){var o=t.find(r(e).childAndParentsRelationships,function(e){return!!t.find(r(e).sources,{id:n.id})});return{$childAndParentsId:o.id}},function(e){return t.flatMap(r(e).childAndParentsRelationships,function(e){return e.sources})})))},o}),e("parentsAndChildren",["attribution","changeHistory","fact","globals","helpers","notes","plumbing","sources"],function(e,t,n,r,o,s,i,c){var u=o.maybe,a={},p=a.ChildAndParents=function(){};a.ChildAndParents.prototype={constructor:p,$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||[]},$getFatherId:function(){return u(this.father).resourceId},$getFatherUrl:function(){return o.removeAccessToken(u(this.father).resource)},$getFather:function(){return r.getPerson(this.$getFatherUrl())},$getMotherId:function(){return u(this.mother).resourceId},$getMotherUrl:function(){return o.removeAccessToken(u(this.mother).resource)},$getMother:function(){return r.getPerson(this.$getMotherUrl())},$getChildId:function(){return u(this.child).resourceId},$getChildUrl:function(){return o.removeAccessToken(u(this.child).resource)},$getChild:function(){return r.getPerson(this.$getChildUrl())},$getNoteRefs:function(){return s.getChildAndParentsNoteRefs(o.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return c.getChildAndParentsSourceRefs(o.removeAccessToken(u(this.links["source-references"]).href))},$getChanges:function(){return t.getChildAndParentsChanges(o.removeAccessToken(u(this.links["change-history"]).href))}},a.getChildAndParents=function(t,s,c){return o.chainHttpPromises(i.getUrl("child-and-parents-relationship-template",t,{caprid:t}),function(t){return i.get(t,s,{Accept:"application/x-fs-v1+json"},c,o.compose(o.constructorSetter(p,"childAndParentsRelationships"),o.objectExtender(f),o.constructorSetter(n.Fact,"motherFacts",function(e){return u(e).childAndParentsRelationships}),o.constructorSetter(n.Fact,"fatherFacts",function(e){return u(e).childAndParentsRelationships}),o.constructorSetter(e.Attribution,"attribution",function(e){return o.flatMap(e.childAndParentsRelationships,function(e){return o.union(e.motherFacts,e.fatherFacts)})}),r.personMapper()))})};var f={getRelationship:function(){return u(this.childAndParentsRelationships)[0]},getPerson:function(e){return o.find(this.persons,{id:e})}};return a}),e("pedigree",["globals","helpers","plumbing"],function(e,t,n){function r(e){return{getPersons:function(){return this.persons},exists:function(n){return!!s(t.find(this.persons,o(e,n))).id},getPerson:function(n){return t.find(this.persons,o(e,n))}}}function o(e,t){return function(n){return n.display[e]==t}}var s=t.maybe,i={};return i.getAncestry=function(o,i,c){return t.chainHttpPromises(n.getUrl("ancestry-query"),function(u){return n.get(u,t.extend({person:o},i),{},c,t.compose(t.objectExtender(r("ascendancyNumber")),e.personMapper(),t.objectExtender({getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(e){return s(e).persons})))})},i.getDescendancy=function(o,i,c){return t.chainHttpPromises(n.getUrl("descendancy-query"),function(u){return n.get(u,t.extend({person:o},i),{},c,t.compose(t.objectExtender(r("descendancyNumber")),e.personMapper(),t.objectExtender({getDescendancyNumber:function(){return this.display.descendancyNumber}},function(e){return s(e).persons})))})},i}),e("spouses",["attribution","changeHistory","fact","globals","helpers","plumbing","notes","sources"],function(e,t,n,r,o,s,i,c){var u=o.maybe,a={},p=a.Couple=function(){};a.Couple.prototype={constructor:p,$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return o.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return u(this.person1).resourceId},$getHusbandUrl:function(){return o.removeAccessToken(u(this.person1).resource)},$getHusband:function(){return r.getPerson(this.$getHusbandUrl())},$getWifeId:function(){return u(this.person2).resourceId},$getWifeUrl:function(){return o.removeAccessToken(u(this.person2).resource)},$getWife:function(){return r.getPerson(this.$getWifeUrl())},$getNoteRefs:function(){return i.getCoupleNoteRefs(o.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return c.getCoupleSourceRefs(o.removeAccessToken(this.links["source-references"].href))},$getChanges:function(){return t.getCoupleChanges(o.removeAccessToken(u(this.links["change-history"]).href))}},a.getCouple=function(t,i,c){return o.chainHttpPromises(s.getUrl("couple-relationship-template",t,{crid:t}),function(t){return s.get(t,i,{},c,o.compose(o.constructorSetter(p,"relationships"),o.objectExtender(f),o.constructorSetter(n.Fact,"facts",function(e){return u(e).relationships}),o.constructorSetter(e.Attribution,"attribution",function(e){return o.flatMap(e.relationships,function(e){return e.facts})}),r.personMapper()))})};var f={getRelationship:function(){return u(this.relationships)[0]},getPerson:function(e){return o.find(this.persons,{id:e})}};return a}),e("person",["attribution","changeHistory","discussions","fact","globals","helpers","memories","name","notes","parentsAndChildren","plumbing","sources","spouses"],function(e,t,n,r,o,s,i,c,u,a,p,f,l){function h(e){return!e.attribution||!e.attribution.changeMessage||e.attribution.contributor}function g(e){return e?" "+e:""}var d=s.maybe,m={},y=m.Person=function(){};m.Person.prototype={constructor:y,$getFacts:function(e){return(e?s.filter(this.facts,{type:e}):this.facts)||[]},$getFact:function(e){return s.find(this.facts,{type:e})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var e=this.$getBirth();return e?e.$getDate():""},$getBirthPlace:function(){var e=this.$getBirth();return e?e.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var e=this.$getChristening();return e?e.$getDate():""},$getChristeningPlace:function(){var e=this.$getChristening();return e?e.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var e=this.$getDeath();return e?e.$getDate():""},$getDeathPlace:function(){var e=this.$getDeath();return e?e.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var e=this.$getBurial();return e?e.$getDate():""},$getBurialPlace:function(){var e=this.$getBurial();return e?e.$getPlace():""},$getDisplayBirthDate:function(){return d(this.display).birthDate},$getDisplayBirthPlace:function(){return d(this.display).birthPlace},$getDisplayDeathDate:function(){return d(this.display).deathDate},$getDisplayDeathPlace:function(){return d(this.display).deathPlace},$getDisplayGender:function(){return d(this.display).gender},$getDisplayLifeSpan:function(){return d(this.display).lifespan},$getDisplayName:function(){return d(this.display).name},$getNames:function(e){return(e?s.filter(this.names,{type:e}):this.names)||[]},$getPreferredName:function(){return s.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var e=this.$getPreferredName();return e&&(e=e.$getGivenName()),e},$getSurname:function(){var e=this.$getPreferredName();return e&&(e=e.$getSurname()),e},$getPersistentIdentifier:function(){return d(d(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getChanges:function(e){return t.getPersonChanges(s.removeAccessToken(this.links["change-history"].href),e)},$getDiscussionRefs:function(){return n.getPersonDiscussionRefs(s.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return i.getMemoryPersonaRefs(s.removeAccessToken(this.links["evidence-references"].href))},$getNoteRefs:function(){return u.getPersonNoteRefs(s.removeAccessToken(this.links.notes.href))},$getPersonSourceRefs:function(){return f.getPersonSourceRefs(s.removeAccessToken(this.links["source-references"].href))},$getRelationshipsToSpouses:function(e){return m.getRelationshipsToSpouses(s.removeAccessToken(this.links["spouse-relationships"].href),e)},$addName:function(e){return s.isArray(this.names)||(this.names=[]),e instanceof c.Name||(e=new c.Name(e)),this.names.push(e),this},$deleteName:function(e,t){e instanceof c.Name||(e=s.find(this.names,{id:e}));var n=s.indexOf(this.names,e);return n>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[e.id]=t,this.names.splice(n,1)),this},$addFact:function(e){return s.isArray(this.facts)||(this.facts=[]),e instanceof r.Fact||(e=new r.Fact(e)),this.facts.push(e),this},$deleteFact:function(e,t){e instanceof r.Fact||(e=s.find(this.facts,{id:e}));var n=s.indexOf(this.facts,e);return n>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[e.id]=t,this.facts.splice(n,1)),this},$setGender:function(t,n){return this.gender||(this.gender={}),this.gender.$changed=!0,this.gender.type=t,n&&(this.gender.attribution=new e.Attribution(n)),this},$save:function(t,n,r){var o=new y,i=!1;this.id&&(o.id=this.id),this.id||(this.gender||this.$setGender("http://gedcomx.org/Unknown"),s.isArray(this.names)&&0!==this.names.length||this.$addName({fullText:"Unknown",givenName:"Unknown"}),s.find(this.names,{preferred:!0})||this.names[0].$setPreferred(!0),1!==this.names.length||this.names[0].type||this.names[0].$setType("http://gedcomx.org/BirthName")),!this.gender||this.gender.id&&!this.gender.$changed||(t&&h(this.gender)&&(this.gender.attribution=new e.Attribution(t)),o.gender=this.gender,i=!0),s.forEach(this.names,function(e){(!e.id||e.$changed)&&(e.$getFullText()||e.$setFullText((e.$getPrefix()+g(e.$getGivenName())+g(e.$getSurname())+g(e.$getSuffix())).trim()),t&&h(e)&&e.$setChangeMessage(t),o.$addName(e),i=!0)}),s.forEach(this.facts,function(e){(!e.id||e.$changed)&&(t&&h(e)&&e.$setChangeMessage(t),o.$addFact(e),i=!0)});var c=[];i&&c.push(s.chainHttpPromises(o.id?p.getUrl("person-template",null,{pid:o.id}):p.getUrl("persons"),function(e){return p.post(e,{persons:[o]},{},r,s.getResponseEntityId)})),this.id&&this.$deletedConclusions&&s.forEach(this.$deletedConclusions,function(e,n){e=e||t,c.push(s.chainHttpPromises(p.getUrl("person-conclusion-template",null,{pid:o.id,cid:n}),function(t){return p.del(t,e?{"X-Reason":e}:{},r)}))});var u=this,a=s.promiseAll(c).then(function(e){var t=o.id?o.id:e[0];return s.extendHttpPromise(a,c[0]),n?m.getPerson(t,{},r).then(function(e){return s.deleteProperties(u),s.extend(u,e.getPerson()),t}):t});return a},$delete:function(e,t){return m.deletePerson(s.removeAccessToken(d(d(this.links).person).href)||this.id,e,t)},$addMemoryPersonaRef:function(e,t,n){return i.addMemoryPersonaRef(this.id,e,t,n)}},o.getPerson=m.getPerson=function(e,t,n){return s.chainHttpPromises(p.getUrl("person-template",e,{pid:e}),function(e){return p.get(e,t,{},n,s.compose(s.objectExtender({getPerson:function(){return this.persons[0]}}),m.personMapper()))})},o.personMapper=m.personMapper=function(t){var n=function(e){return s.flatMap(t?t(e):[e],function(e){return e.persons})};return s.compose(s.constructorSetter(y,"persons",t),s.constructorSetter(c.Name,"names",n),s.constructorSetter(r.Fact,"facts",n),s.constructorSetter(e.Attribution,"attribution",function(e){return s.flatMap(n(e),function(e){return s.union([e],e.names,e.facts,e.gender?[e.gender]:[])})}))},m.getMultiPerson=function(e,t,n){var r={};return s.forEach(e,function(e){r[e]=m.getPerson(e,t,n)}),s.promiseAll(r)},m.getPersonWithRelationships=function(t,n,o){return s.chainHttpPromises(p.getUrl("person-with-relationships-query"),function(i){return p.get(i,s.extend({person:t},n),{},o,s.compose(s.objectExtender({getPrimaryId:function(){return t}}),s.constructorSetter(r.Fact,"fatherFacts",function(e){return e.childAndParentsRelationships}),s.constructorSetter(r.Fact,"motherFacts",function(e){return e.childAndParentsRelationships}),s.constructorSetter(e.Attribution,"attribution",function(e){return s.flatMap(e.childAndParentsRelationships,function(e){return s.union(e.fatherFacts,e.motherFacts)})}),s.constructorSetter(r.Fact,"facts",function(e){return e.relationships}),s.constructorSetter(e.Attribution,"attribution",function(e){return s.flatMap(e.relationships,function(e){return e.facts})}),s.constructorSetter(a.ChildAndParents,"childAndParentsRelationships"),s.constructorSetter(l.Couple,"relationships"),s.objectExtender(P),m.personMapper()))})};var P={getPerson:function(e){return s.find(this.persons,{id:e})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var e=this.getPrimaryId();return s.filter(this.childAndParentsRelationships,function(t){return d(t.child).resourceId===e})},getSpouseRelationships:function(){return s.filter(this.relationships,function(e){return"http://gedcomx.org/Couple"===e.type})},getSpouseRelationship:function(e){var t=this.getPrimaryId();return s.find(this.relationships,function(n){return"http://gedcomx.org/Couple"===n.type&&(t===n.$getHusbandId()?n.$getWifeId():n.$getHusbandId())===e})},getChildRelationships:function(){var e=this.getPrimaryId();return s.filter(this.childAndParentsRelationships,function(t){return d(t.father).resourceId===e||d(t.mother).resourceId===e})},getChildRelationshipsOf:function(e){var t=this.getPrimaryId();return s.filter(this.childAndParentsRelationships,function(n){return!(d(n.father).resourceId!==t&&d(n.mother).resourceId!==t||d(n.father).resourceId!=e&&d(n.mother).resourceId!=e)})},getFatherIds:function(){return s.uniq(s.map(s.filter(this.getParentRelationships(),function(e){return!!e.$getFatherId()}),function(e){return e.$getFatherId()},this))},getFathers:function(){return s.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return s.uniq(s.map(s.filter(this.getParentRelationships(),function(e){return!!e.$getMotherId()}),function(e){return e.$getMotherId()},this))},getMothers:function(){return s.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return s.uniq(s.map(s.filter(this.getSpouseRelationships(),function(e){return e.$getHusbandId()&&e.$getWifeId()}),function(e){return this.getPrimaryId()===e.$getHusbandId()?e.$getWifeId():e.$getHusbandId()},this))},getSpouses:function(){return s.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return s.uniq(s.map(this.getChildRelationships(),function(e){return e.$getChildId()},this))},getChildren:function(){return s.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(e){return s.uniq(s.map(this.getChildRelationshipsOf(e),function(e){return e.$getChildId()},this))},getChildrenOf:function(e){return s.map(this.getChildIdsOf(e),this.getPerson,this)}};m.getPersonChangeSummary=function(e,n,r){return s.chainHttpPromises(p.getUrl("person-change-summary-template",e,{pid:e}),function(e){return p.get(e,n,{Accept:"application/x-gedcomx-atom+json"},r,s.compose(s.objectExtender({getChanges:function(){return this.entries||[]}}),s.constructorSetter(t.Change,"entries")))})},m.getRelationshipsToSpouses=function(t,n,o){return s.chainHttpPromises(p.getUrl("spouse-relationships-template",t,{pid:t}),function(i){return p.get(i,n,{},o,s.compose(s.objectExtender({getPrimaryId:function(){return t}}),s.constructorSetter(l.Couple,"relationships"),s.objectExtender(v),s.constructorSetter(r.Fact,"facts",function(e){return e.relationships}),s.constructorSetter(e.Attribution,"attribution",function(e){return s.flatMap(e.relationships,function(e){return e.facts})}),m.personMapper()))})};var v={getRelationships:function(){return this.relationships||[]},getSpouseIds:function(){var e=this.getPrimaryId();return s.uniq(s.map(this.getRelationships(),function(t){return t.$getHusbandId()===e?t.$getWifeId():t.$getHusbandId()},this))},getPerson:function(e){return s.find(this.persons,{id:e})}};return m.deletePerson=function(e,t,n){return s.chainHttpPromises(p.getUrl("person-template",e,{pid:e}),function(r){return p.del(r,t?{"X-Reason":t}:{},n,function(){return e})})},m}),e("searchAndMatch",["globals","helpers","plumbing"],function(e,t,n){function r(e){return e=e.replace(/[:"]/g,"").trim(),e.indexOf(" ")>=0?'"'+e+'"':e}function o(e){return t.map(t.filter(t.keys(e),function(e){return!a[e]}),function(t){return t+":"+r(e[t])}).join(" ")}function s(){return t.compose(t.objectExtender(p),t.constructorSetter(u,"entries"),e.personMapper(function(e){return t.map(i(e).entries,function(e){return i(e.content).gedcomx})}))}var i=t.maybe,c={},u=c.SearchResult=function(){};c.SearchResult.prototype={constructor:u,$getPerson:function(e){return t.find(i(i(this.content).gedcomx).persons,{id:e})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return e.getPerson(this.id)},$getFatherIds:function(){var e=this.id,n=this;return t.uniq(t.map(t.filter(i(i(this.content).gedcomx).relationships,function(t){return"http://gedcomx.org/ParentChild"===t.type&&t.person2.resourceId===e&&t.person1&&"http://gedcomx.org/Male"===i(n.$getPerson(t.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},$getFathers:function(){return t.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var e=this.id,n=this;return t.uniq(t.map(t.filter(i(i(this.content).gedcomx).relationships,function(t){return"http://gedcomx.org/ParentChild"===t.type&&t.person2.resourceId===e&&t.person1&&"http://gedcomx.org/Male"!==i(n.$getPerson(t.person1.resourceId).gender).type}),function(e){return e.person1.resourceId}))},$getMothers:function(){return t.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var e=this.id;return t.uniq(t.map(t.filter(i(i(this.content).gedcomx).relationships,function(t){return"http://gedcomx.org/Couple"===t.type&&(t.person1.resourceId===e||t.person2.resourceId===e)}),function(t){return t.person1.resourceId===e?t.person2.resourceId:t.person1.resourceId}))},$getSpouses:function(){return t.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var e=this.id;return t.uniq(t.map(t.filter(i(i(this.content).gedcomx).relationships,function(t){return"http://gedcomx.org/ParentChild"===t.type&&t.person1.resourceId===e&&t.person2}),function(e){return e.person2.resourceId}))},$getChildren:function(){return t.map(this.$getChildIds(),this.$getPerson,this)}};var a={start:!0,count:!0,context:!0},p={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results},getIndex:function(){return this.index}};return c.getPersonSearch=function(e,r){return t.chainHttpPromises(n.getUrl("person-search"),function(i){return n.get(i,t.removeEmptyProperties({q:o(e),start:e.start,count:e.count,context:e.context}),{Accept:"application/x-gedcomx-atom+json"},r,t.compose(s(),function(e,t){return e.getContext=function(){return t.getResponseHeader("X-FS-Page-Context")},e}))})},c.getPersonMatches=function(e,r,o){return t.chainHttpPromises(n.getUrl("person-matches-template",e,{pid:e}),function(e){return n.get(e,r,{Accept:"application/x-gedcomx-atom+json"},o,s())})},c.getPersonMatchesQuery=function(e,r){return t.chainHttpPromises(n.getUrl("person-matches-query"),function(i){return n.get(i,t.removeEmptyProperties({q:o(e),start:e.start,count:e.count}),{Accept:"application/x-gedcomx-atom+json"},r,s())})},c}),e("sourceBox",["attribution","helpers","plumbing","sources"],function(e,t,n,r){var o=t.maybe,s={},i=s.Collection=function(){};return s.Collection.prototype={constructor:i,$getSourceDescriptions:function(e){return s.getCollectionSourceDescriptions(t.removeAccessToken(this.links["source-descriptions"].href),e)}},s.getCollectionsForUser=function(r,o,s){return t.chainHttpPromises(n.getUrl("user-collections-for-user-template",r,{uid:r}),function(r){return n.get(r,{},{Accept:"application/x-fs-v1+json"},s,t.compose(t.objectExtender({getCollections:function(){return this.collections||[]}}),t.constructorSetter(i,"collections"),t.constructorSetter(e.Attribution,"attribution",function(e){return e.collections})))})},s.getCollection=function(r,s,c){return t.chainHttpPromises(n.getUrl("user-collection-template",r,{udcid:r}),function(r){return n.get(r,s,{Accept:"application/x-fs-v1+json"},c,t.compose(t.objectExtender({getCollection:function(){return o(this.collections)[0]}}),t.constructorSetter(i,"collections"),t.constructorSetter(e.Attribution,"attribution",function(e){return e.collections})))})},s.getCollectionSourceDescriptions=function(o,s,i){return t.chainHttpPromises(n.getUrl("user-collection-source-descriptions-template",o,{udcid:o}),function(o){return n.get(o,s,{Accept:"application/x-fs-v1+json"},i,t.compose(t.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),t.constructorSetter(r.SourceDescription,"sourceDescriptions"),t.constructorSetter(e.Attribution,"attribution",function(e){return e.sourceDescriptions})))})},s.getCollectionSourceDescriptionsForUser=function(o,s,i){return t.chainHttpPromises(n.getUrl("user-collections-source-descriptions-for-user-template",o,{uid:o}),function(o){return n.get(o,s,{Accept:"application/x-fs-v1+json"},i,t.compose(t.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]
}}),t.constructorSetter(r.SourceDescription,"sourceDescriptions"),t.constructorSetter(e.Attribution,"attribution",function(e){return e.sourceDescriptions})))})},s}),e("FamilySearch",["init","authentication","authorities","changeHistory","discussions","fact","memories","name","notes","parentsAndChildren","pedigree","person","searchAndMatch","sourceBox","sources","spouses","user","plumbing"],function(e,t,n,r,o,s,i,c,u,a,p,f,l,h,g,d,m,y){return{init:e.init,getAuthCode:t.getAuthCode,getAccessToken:t.getAccessToken,getAccessTokenForMobile:t.getAccessTokenForMobile,hasAccessToken:t.hasAccessToken,invalidateAccessToken:t.invalidateAccessToken,Date:n.Date,Place:n.Place,getDate:n.getDate,getPlace:n.getPlace,Change:r.Change,getPersonChanges:r.getPersonChanges,getChildAndParentsChanges:r.getChildAndParentsChanges,getCoupleChanges:r.getCoupleChanges,Discussion:o.Discussion,DiscussionRef:o.DiscussionRef,Comment:o.Comment,getPersonDiscussionRefs:o.getPersonDiscussionRefs,getDiscussion:o.getDiscussion,getMultiDiscussion:o.getMultiDiscussion,getComments:o.getComments,Fact:s.Fact,Memory:i.Memory,MemoryPersonaRef:i.MemoryPersonaRef,MemoryPersona:i.MemoryPersona,getMemoryPersonaRefs:i.getMemoryPersonaRefs,getMemory:i.getMemory,getMemoryComments:i.getMemoryComments,getMemoryPersonas:i.getMemoryPersonas,getPersonPortraitUrl:i.getPersonPortraitUrl,getPersonMemoriesQuery:i.getPersonMemoriesQuery,getUserMemoriesQuery:i.getUserMemoriesQuery,createMemory:i.createMemory,addMemoryPersona:i.addMemoryPersona,addMemoryPersonaRef:i.addMemoryPersonaRef,Name:c.Name,Note:u.Note,NoteRef:u.NoteRef,getPersonNoteRefs:u.getPersonNoteRefs,getPersonNote:u.getPersonNote,getMultiPersonNote:u.getMultiPersonNote,getCoupleNoteRefs:u.getCoupleNoteRefs,getCoupleNote:u.getCoupleNote,getMultiCoupleNote:u.getMultiCoupleNote,getChildAndParentsNoteRefs:u.getChildAndParentsNoteRefs,getChildAndParentsNote:u.getChildAndParentsNote,getMultiChildAndParentsNote:u.getMultiChildAndParentsNote,ChildAndParents:a.ChildAndParents,getChildAndParents:a.getChildAndParents,getAncestry:p.getAncestry,getDescendancy:p.getDescendancy,Person:f.Person,deletePerson:f.deletePerson,getPerson:f.getPerson,getMultiPerson:f.getMultiPerson,getPersonWithRelationships:f.getPersonWithRelationships,getPersonChangeSummary:f.getPersonChangeSummary,getRelationshipsToSpouses:f.getRelationshipsToSpouses,SearchResult:l.SearchResult,getPersonSearch:l.getPersonSearch,getPersonMatches:l.getPersonMatches,getPersonMatchesQuery:l.getPersonMatchesQuery,Collection:h.Collection,getCollectionsForUser:h.getCollectionsForUser,getCollection:h.getCollection,getCollectionSourceDescriptions:h.getCollectionSourceDescriptions,getCollectionSourceDescriptionsForUser:h.getCollectionSourceDescriptionsForUser,SourceDescription:g.SourceDescription,SourceRef:g.SourceRef,getPersonSourceRefs:g.getPersonSourceRefs,getSourceDescription:g.getSourceDescription,getMultiSourceDescription:g.getMultiSourceDescription,getCoupleSourceRefs:g.getCoupleSourceRefs,getChildAndParentsSourceRefs:g.getChildAndParentsSourceRefs,getSourceRefsQuery:g.getSourceRefsQuery,Couple:d.Couple,getCouple:d.getCouple,Agent:m.Agent,User:m.User,getCurrentUser:m.getCurrentUser,getCurrentUserPersonId:m.getCurrentUserPersonId,getAgent:m.getAgent,getMultiAgent:m.getMultiAgent,get:y.get,post:y.post,put:y.put,del:y.del,http:y.http,getTotalProcessingTime:y.getTotalProcessingTime,setTotalProcessingTime:y.setTotalProcessingTime}}),t("FamilySearch")});